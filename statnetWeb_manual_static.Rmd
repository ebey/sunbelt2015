---
title: "statnetWeb for Social Network Analysis"
author: "Emily Beylerian"
output:
  html_document:
    toc: true
    mathjax: default
    css: sW.css
---

# Introduction to statnetWeb

statnetWeb is a prototype web interactive application for social network analysis. Users can perform complete analyses of relational data (including network visualization, model estimation and evaluation, and model-based simulation) through the user-friendly interface and can download results and figures throughout the process. 

This document is meant to serve as a guide to using statnetWeb as a teaching tool for introductory network analysis courses. Below we provide a course outline template with references to in-depth resources for certain topics. Following the course template is a brief summary of the programming involved in creating statnetWeb.

Suggestions for improvements and additional functionality to statnetWeb are welcome!

## Why These Tools?

Network analysis techniques have progressed immensely over the past 60 years and continue to develop quickly. 
<ul>
<li> Graph theoretic summaries
  <ul>
  <li>Degree distribution, geodesics, centrality measures, etc.
  <li>No inference
  </ul>
<li> Conditionally uniform models (Holland and Leinhardt 1976, Wasserman 1977)
  <ul>
  <li>Useful as null hypotheses, but don't give indications of how to model
  </ul>
<li> $p_1$ model ([Holland and Leinhardt 1981](http://www.stat.cmu.edu/~fienberg/Stat36-835/HollandLeinhardt-JASA-1981.pdf))
  <ul>
  <li>Statistical inference
  <li>Large number of parameters
  </ul>
<li> Markov model
  <ul>
  <li>Dyad dependence
  </ul>
<li> ERGMs
</ul>


As the field grows, software programs geared toward various types of network analysis (above) are created. A dichotomy has emerged between those accessed with a graphical user interface and those accessed through the command line. Although GUI-based programs are easier for a wide range of people to interact with, the analysis possibilities are limited to the specific options provided in the interface. On the other hand, command line interfaces allow the user much more flexibility, but require a significant initial investment to learn the syntax of a programming language.

The [statnet](https://statnet.csde.washington.edu/trac) project encompasses a suite of packages in the R programming language and provides a comprehensive framework for statistical network modeling based on exponential family random graph models. 
Learning how to program in R before accessing these powerful statistical analysis tools presents a large barrier to many people who are new to network analysis, so we created statnetWeb in order to reduce the upfront obstacles.

The functionality of statnetWeb is based on the **ergm** package, a member of the statnet software suite, and also incorporates the associated packages **network** and **sna**. The app occupies a middle ground in the spectrum of software accessibility and we see it as a valuable tool for teaching and understanding the concepts and process of network analysis in a context less dependent on programming expertise. For in depth analysis, researchers can transition into accessing the full functionality of statnet through the command line. 

statnetWeb is built with [Shiny](http://shiny.rstudio.com/), a framework for creating web applications with content written in R.  The app is available online at https://ebey.shinyapps.io/statnetWeb/ or can be run locally through RStudio. Development is on [GitHub](https://github.com/statnet/statnetWeb), where anyone can browse the code, make suggestions and report issues. 

To learn more about statnet, see the [statnet Wiki](https://statnet.csde.washington.edu/trac), where you can find publications, tutorials and recent news.

# Course Material

## Basic Components of Network Analysis

<font class="lobj">Learning objectives:</font> Know what a network is, what it can represent and why we use it. Gain a broad sense of network analysis uses and methods.

**What is a network?** A population of nodes with links.
<ul>
<li>*Nodes:* aka vertices, actors</li>
  <ul>
  <li>Represent individual entities (people, organizations, etc.), which may be connected to each other by *links*.</li>
  <li>Nodes can have associated categorical or quantitative attributes (age, sex, etc.).</li>
  </ul>
<li>*Links:* aka edges, ties</li>
  <ul>
  <li>Can be directed/undirected and valued/binary</li>
  </ul>
<li>Types of networks: bipartite, valued, directed, etc.</li>
  <ul>
  <li>Defined by properties of the nodes and links</li>
  </ul>
</ul>

![](images/samplenets_small.png)

**Motivation**  
What can we accomplish with network analysis?  
<ul>
<li>Examples</li>
  <ul>
  <li>Show examples with statnetWeb</li>
  </ul>
<li>Glimpse ahead to types of analysis</li>
</ul>

**Network data storage and representation**
<ul>
<li>Overview of adjacency matrices, incidence matrices, edge lists</li>
</ul>
**Network data as a graph**
<ul>
<li>Graph notation</li>
<li>Graph terminology</li>
</ul>

**Network data sampling designs**
<ul>
<li>Census: data on every node and link in the population of interest</li>
<li>Adaptive sample: link-tracing designs, e.g., snowballs, respondent-driven sampling, etc.</li>
<li>Egocentric sample: a sample of nodes (egos) with data on their links to other nodes (alters).  The alters may or may not be identifiable, and may or may not be in the sample, and data may or may not exist on ties between the alters (as reported by ego).</li>
</ul>
**Types of statistical network analysis**  
See [Snijders 2011](http://www.stats.ox.ac.uk/~snijders/StatModelsSocNetworks.pdf)
<ul>
<li>Descriptive</li>
  <ul>
  <li>A set of summary statistics calculated on the network</li>
  <ul>
  <li>E.g., density, degree distribution, centrality, etc.</li>
  </ul>
  </ul>
<li>Statistical</li>
  <ul>
  <li>If the researcher can capture the underlying structural features of a network with a few parameters, they can gain insight to how that structure influences the individual actors and relationships in the network and predict the structure of other networks.
  <li>The researcher creates a model, assumes that the observed network is the outcome of a random draw from that model.
  <ul>
  <li>A model represents the factors that determine the probability of a link between two nodes, with parameters that can be estimated from network data.</li>
  </ul>
  <li>Models for links, nodal attributes fixed:</li>
  <ul>
  <li>In simple random graphs, each edge between two nodes is equally likely - not the case for most social networks</li>
  <ul>
  <li>The chance of a tie between nodes i and j may depend on the attributes of i and j (e.g. Homophily)</li>
  </ul>
  </ul>
  <li>Joint models for nodal attributes and links:  Influence and Selection</li>
  <ul>
  <li>Transitivity
  </ul>
  </ul>
</ul>

<font class="ex">Exercise:</font> Read introductory chapters of a social network analysis textbook. Read published network analysis paper and identify type of analysis and why it was used.

## Network Data

<font class="lobj">Learning objectives:</font> Know differences between network representation methods and advantages/disadvantages of each. Practice creating networks, translating between each representation and uploading to statnetWeb.

Outside of statnetWeb, the nodes and edges of a network can be denoted by adjacency matrices, incidence matrices or edge lists.
<ul>
<li>Example of each representation with same network
<li>Limitations of each
<li>The network type will be reflected in the data
</ul>


#### statnetWeb: Data

Observed network data can be uploaded to statnetWeb in various formats. From the Upload Network tab, the user can transfer files saved in Excel, R or Pajek into statnetWeb for further analysis.  
![matrix upload](images/sw_uploaddata.png)

<ul>
<li>**Excel:** </li>
  <ul>
  <li>Specify the type of matrix and upload a .csv file of relational data. </li>
  <li>Adjacency matrices should have vertex labels in the first row and column.</li>
  <li>Incidence matrices should have edge labels in the first row and vertex labels in the first column.</li>
  <li>Edge lists should not have row or column labels.</li>
  </ul>
<li>**R:** </li>
  <ul>
  <li>Upload a matrix of relational data or a statnet network object. </li>
  <li>Objects should be exported from R using the command `save(objectname, file="newfilename"  )`.  
  By default the file will be saved into the current working directory, but the full path to a new location can be specified in the `file=` argument, or set `file=file.choose(new=TRUE)` to use a save dialog box.</li>
  </ul>
<li>**Pajek:** </li>
  <ul>
  <li>Upload network or project files (.net or .paj, respectively). </li>
  </ul>
</ul>  


Alternatively, the user can choose from pre-loaded sample networks to experiment with while becoming familiar with statnetWeb.

Once a network has been uploaded, a summary of the network's properties will be displayed on the right side of the page.

![sample networks](images/sw_uploaddata2.png) ![nw summary](images/mesa_nwsum.png)

**Missing Data**
<ul>
<li>Missing edge $\not\Rightarrow$ no edge</li>
<li>statnet interprets NA entries not along the diagonal as missing
</ul>

<font class="ex">Exercise:</font> Practice creating networks, translating between each representation and uploading to statnetWeb.

## Network Descriptives

<font class="lobj">Learning objectives:</font>

Network descriptives are valuable for gaining insight into the observed network. Exploring plots and descriptive statistics before fitting a model can lead to better model formulations and improve interpretation of results.  


#### statnetWeb: Network Descriptives

**Network Plot**  
Looking at a network plot can give a general sense of the network, and editing the display options is even more revealing. When the nodes of the faux.mesa.high network are color-coded, it is easy to see clustering by grade. Likewise, sizing the nodes of the flomarriage by wealth shows a tendency for wealthier families to have more marriage ties.

In statnetWeb, any nodal attributes will be available in the color-coding menu. Numeric attributes, plus the betweenness measures of the nodes will be available in the sizing menu.

![fmh1](images/mesa_plot.png) ![fmh2](images/mesa_colorplot.png)
![flomarriage wealth](images/flomarriage_wealthplot.png)

**Degree Distribution**  
Inspect the distribution of nodal degrees throughout the network. Do most nodes have similar degree? Are there a few nodes with high degree ("hubs") and many with low degree? Does the distribution vary by attribute? 

![](images/mesa_degreedist_small.png)

Null models: 
<ul>
<li>Conditional uniform graphs (CUG): Draws from the distribution of simple random graphs with the same fixed density as the observed network.</li>
<li>Bernoulli random graphs (BRG): Draws from the distribution of simple random graphs with the same stochastic tie probability as the observed network.</li>
</ul>  

<font class="ex">Exercise:</font> What is different about the null models? Are there situations when one would be more important than the other? How does the observed network compare to the null models and what does that tell us?

![](images/mesa_degreedist_nullsmall.png)

**Geodesic Distribution**  
The geodesic measures the length of the shortest path between two nodes. A geodesic distance of "inf" between two nodes means that they are not connected by any path. Compare the distribution of the geodesics from all the dyads in the observed network to null models.

When compared to the null models, the faux.mesa.high network has fewer paths of length 5-8 than we would expect, and more disconnected node pairs (with geodesic distance inf).  
![mesa geodist](images/mesa_geodist_small.png)

**More**
<ul>
<li>Mixing matrices</li>
<li>Node-level indices</li>
  <ul>
  <li>Degree, Betweenness, Closeness, Stress Centrality, Graph Centrality, Eigenvector Centrality, Information Centrality
  </ul>
<li>Graph-level indices</li>
  <ul>
  <li>Reciprocity, Transitivity, Density, Degree, Betweenness, Closeness, etc.
  </ul>
</ul>

## Statistical Models

<font class="lobj">Learning objectives:</font> What can ERGMs represent that other models can't?

The appropriate model depends on the type of data. For now, we consider fully observed binary networks.

Recall, we want to capture the underlying structural features of a network with a few parameters.
<ul>
<li>Covariate effects, odds ratios for tie preferences
<li>Logistic regression
$$\begin{align*}
 \Pr( y_{1,2} = 1 | x_1,x_2 ) &= 
\frac{ e^{ \beta_0 + \beta_1 x_1 + \beta_2 x_2 +    \beta_{12} x_1 x_2}    }
      {1+ e^{ \beta_0 + \beta_1 x_1 + \beta_2 x_2 +     \beta_{12} x_1 x_2 }  } \\ \\
\Pr( y_{1,2} = 0 | x_1,x_2 ) &= 
\frac{1}{1+e^{\beta_0+\beta_1 x_1 + \beta_2 x_2 +  \beta_{12} x_1 x_2 } } \\ \\
\text{odds}( y_{1,2} = 1 | x_1,x_2 ) &= 
  \exp( \beta_0+\beta_1 x_1 + \beta_2 x_2 +  \beta_{12} x_1 x_2 ) \\ \\
\text{log odds}( y_{1,2} = 1 | x_1,x_2 ) &= 
  \beta_0+\beta_1 x_1 + \beta_2 x_2 +  \beta_{12} x_1 x_2  
\end{align*}$$

<li>Conditionally uniform models
<li>Latent space models
<ul> 
<li>$p_1$ model
<li>$p_2$ model
</ul>
<li>Exponential random graph models ($p^*$)
</ul>

### ERG Model Specification

**What is an ERGM?**  
Exponential-family random graph models are a class of models for specifying the probability distribution for a set of random graphs or networks.
$$ P(Y=y)=\frac{\mathrm{exp}(\theta'g(y))}{k(\theta)} $$
<ul>
<li> $Y$: random variable for state of network (with realization $y$)
<li> $g(y)$: vector of model statistics for network $y$
<li> $\theta$: vector of coefficients for statistics $g(y)$
<li> $k(\theta)$: numerator summed over all possible networks (with same node set as $y$)
</ul>

Conditional log-odds: $\mathrm{logit}(Y_{ij} = 1|y_{ij}^{c}) = \theta'\delta(y_{ij})$
<ul>
<li>$\delta(y_{ij})$ is the change statistic, i.e. it records how $g(y)$ changes if the tie $y_{ij}$ is toggled on or off</li>
<li>$\theta$ (the coefficient for a model statistic) is the log-odds of an individual tie conditional on all others</li>
</ul>

Our goal is to use key model statistics to fit an exponential-family random graph model (ERGM) to the observed data. We want this model to capture the underlying structure of the network, so we include statistics that we hypothesize differ significantly in the observed network when compared to a simple random graph.  

<u>Important to consider:</u> model statistics are either dyad dependent or dyad independent.

* edges
* triangles
* nodes of degree 0
* nodal homophily (nodematch)

<font class="ex">Exercise:</font> Which of the above terms are dyad dependent? Why?

### ERGM Estimation

#### statnetWeb: Fit Model

We can choose which model statistics to include in an ERGM. In statnetWeb, each model statistic that we want to include is represented by a term in the model formula. There are many terms coded into the statnet software and the term documentation window in statnetWeb gives access to the help file of each one.
<ul>
<li>Browse through all terms or narrow the results down to only the terms that are applicable to the currently loaded network.
<li>Commonly used terms: [click here](statnet.csde.washington.edu/EpiModel/nme/2014/d2-ergmterms.html)
</ul>

How does statnetWeb find a model that fits?  
<ul>
<li>MLE: maximum likelihood estimation</li>
<li>MCMC: only for models with dyadic dependent terms</li>
</ul>

Output from model fitting
<ul>
<li>Iterations - useful to see if model is degenerate</li>
<li>Model summary</li>
  <ul>
  <li>Interpretation of coefficient estimates:</li>
  <ul>
  <li>Conditional log-odds of two actors having a tie is  
  $\theta_1$ x change in stat1 + $\theta_2$ x change in stat2
  <li>Corresponding probability from equation above
  </ul>
  </ul>
  <li>Save up to five models for comparison  
  ![](images/modelcomp.png)
</ul>

<font class="ex">Example: Bernoulli model</font> 
<ul><li>flomarriage ~ edges</li></ul>

<font class="ex">Example: Triad formation</font>  
<ul><li>flomarriage ~ edges + triangle</li></ul>

<font class="ex">Example: Nodal covariates</font>  
<ul><li>flomarriage ~ edges + nodecov("wealth")</li></ul>

<font class="ex">Example: -Inf coefficients</font>  

<font class="ex">Example: Missing data in ERGMs</font>
<ul>
<li>missnet ~ edges
<li>Compare when edges are coded as missing vs. zeros
</ul>


When a model fails
<ul>
<li>Control parameters: burn-in, interval, sample size
<li>If the user is familiar with more MCMC control parameters, they can be entered in the text box.
</ul>

## Model Evaluation

<font class="lobj">Learning objectives:</font>

#### statnetWeb: MCMC Diagnostics

We want the MCMC sample statistics to vary randomly around the observed values and the difference between the observed and simulated values of the sample statistics to have a roughly bell-shaped distribution, centered at 0.  
<ul>
<li>flobusiness ~ edges+degree(1)  
![](images/mcmc_good.png)
</ul>
Interpreting other MCMC diagnostics  
<ul>
<li>flobusiness ~ edges+degree(0)  
flobusiness has 5 isolates, can't have any fewer than -5 from target statistic  
try to modify control parameters and do better
![](images/mcmc_bad.png)
</ul>

#### statnetWeb: Goodness-of-fit

Test how well your model fits the original data by choosing a network statistic that is not in the model, and comparing the value of this statistic observed in the original network to the distribution of values you get in simulated networks from your model.  
When multiple models are saved, compare GOF plots in a chart.

## Model-Based Simulation

<font class="lobj">Learning objectives:</font>

After creating an ergm and checking the diagnostics, we can simulate from it (take examples of networks drawn from this distribution). If the model is a good fit to the observed data, then networks drawn from this distribution will be more likely to “resemble” the observed data.

#### statnetWeb: Simulate

<ul>
<li>View network plot of each simulation; edit display options in the same way as the plot of the observed network.
<li>View plot of simulation statistics compared to the target statistics
[IMAGE OF AUTOCORRELATED STATISTICS]
<li>Edit MCMC controls (e.g. increase the interval if simulation statistics are highly auto-correlated.)
[IMAGE AFTER INCREASING INTERVAL]
<li>Download simulation statistics
</ul>

## Review and Further Topics

<font class="lobj">Learning objectives:</font>

Longitudinal network analysis?

## Course Outlines

**10 Week Course:**

* Network analysis basics: 2 weeks
* Data: 1 week
* Network descriptives: 1 week
* Model estimation: 2 weeks
* Diagnostics: 1 week
* Model-based simulation: 2 weeks
* Review and further topics: 1 week

**14 Week Course:**

* Network analysis basics: 2 weeks
* Data: 1 week
* Network descriptives: 2 week
* Model estimation: 3 weeks
* Diagnostics: 1 week
* Model-based simulation: 2 weeks
* Review and further topics: 3 weeks

# Shiny

The code for statnetWeb is publicly available at our [GitHub repository](https://github.com/statnet/statnetWeb)

![uw logo](images/UW.Wordmark_small.jpg)  
![csde logo](images/csdelogo_crop_small.png) ![csde](images/csde_goudy.fw_small.png)
